generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BloodType {
  A_POS
  A_NEG
  B_POS
  B_NEG
  AB_POS
  AB_NEG
  O_POS
  O_NEG
}

model Stock {
  id          String          @id @db.Uuid
  companyId   String          @db.Uuid @map("company_id")
  bloodType   BloodType       @map("blood_type")
  quantityA   Int             @map("quantity_a")
  quantityB   Int             @map("quantity_b")
  quantityAB  Int             @map("quantity_ab")
  quantityO   Int             @map("quantity_o")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  movements   StockMovement[]

  @@map("stock")
}

model StockMovement {
  id             String   @id @db.Uuid
  stockId        String   @db.Uuid @map("stock_id")
  movement       Int
  quantityBefore Int      @map("quantity_before")
  quantityAfter  Int      @map("quantity_after")
  actionBy       String   @map("action_by")
  notes          String
  createdAt      DateTime @default(now()) @map("created_at")

  stock Stock @relation(fields: [stockId], references: [id])

  @@index([stockId])
  @@map("bloodstock_movement")
}

model Batch {
  id            String    @id @db.Uuid
  companyId     String    @db.Uuid @map("company_id")
  code          String
  bloodType     BloodType @map("blood_type")
  entryQuantity Int       @map("entry_quantity")
  exitQuantity  Int       @map("exit_quantity")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@unique([companyId, code])
  @@index([companyId])
  @@index([bloodType])
  @@map("batch")
}
